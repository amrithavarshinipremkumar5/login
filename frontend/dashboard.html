<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard â€¢ Login System</title>
  <link rel="stylesheet" href="./styles.css"/>
</head>
<body>
  <div class="dashboard-wrap">
    <div class="dashboard-container">
      <header class="dashboard-header">
        <h1>Dashboard</h1>
        <div class="user-info">
          <span class="user-email" id="userEmail">Loading...</span>
          <button class="btn-logout" id="logoutBtn">Logout</button>
        </div>
      </header>

      <div class="dashboard-card">
        <h2>Profile</h2>
        <p>Hello, <strong id="userName">User</strong></p>
        <p>Email: <strong id="userEmailDisplay">--</strong></p>
        <p>Status: <strong id="userStatus">--</strong></p>
      </div>

      <div class="dashboard-card">
        <h2>Protected API check</h2>
        <p>Test calling a protected route with your token:</p>
        <div class="api-test">
          <button class="btn primary-blue" id="callApiBtn">Call protected route</button>
          <div id="apiResponse" class="api-response" style="display:none"></div>
        </div>
      </div>
    </div>
  </div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const token = localStorage.getItem("token");
  const userStr = localStorage.getItem("user");

  if (!token) { location.replace("./index.html"); return; }

  let user = {};
  try { user = JSON.parse(userStr || "{}"); } catch {}

  document.getElementById("userEmail").textContent = user.email || "Unknown";
  document.getElementById("userName").textContent = (user.username || user.email?.split('@')[0] || "User");
  document.getElementById("userEmailDisplay").textContent = user.email || "--";
  document.getElementById("userStatus").textContent = user.status || "--";

  document.getElementById("logoutBtn").addEventListener("click", function() {
    localStorage.removeItem("token");
    localStorage.removeItem("user");
    location.replace("./index.html");
  });

  document.getElementById("callApiBtn").addEventListener("click", async function() {
    const responseEl = document.getElementById("apiResponse");
    responseEl.style.display = "block";
    responseEl.textContent = "Calling API...";

    try {
      // Example protected or public check; replace with your actual protected endpoint if needed
      const r = await fetch(`/api/auth/check-username?u=test`, {
        headers: { "Authorization": `Bearer ${token}` }
      });
      const d = await r.json().catch(()=> ({}));
      responseEl.textContent = JSON.stringify(d, null, 2);
    } catch(e) {
      responseEl.textContent = "Error: " + (e.message || "Network");
    }
  });
});
</script>
</body>
</html>
